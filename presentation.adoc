= Outils pour sites statiques modernes √† l'intention du d√©veloppeur paresseux
David Sferruzza <david.sferruzza@gmail.com>
:imagesdir: img

== Bonjour √† tous !

Je m'appelle *David*, je *d√©veloppe* des sites web (depuis une quinzaine d'ann√©es) et je suis *paresseux* ([.line-through]#depuis toujours#).

== Des _sites web_ ?

La terminologie est vari√©e :

* site web
* application web
* services web
* site Internet

---

NOTE: Il n'y a pas de d√©finitions formelles, c'est parti pour les _abus de langage_ !

== Le principe du site web

On a un *logiciel* qui s'ex√©cute sur un *serveur* pour d√©livrer du *contenu* gr√¢ce au *protocole HTTP* d'un bout √† l'autre du *r√©seau Internet*.

Les *navigateurs* web permettent d'appeler ces contenus, de les *interpr√©ter* et de les *afficher*.

== Sites web : deux familles, deux ambiances

== 1/ Sites statiques

On utilise un logiciel de serveur web *standard* (Apache, nginx, ...) qui va servir du contenu *inerte*.

_Le contenu a √©t√© √©crit pr√©alablement._

== 2/ Sites dynamiques

On *d√©veloppe* une application qui va recevoir chaque requ√™te HTTP et *g√©n√©rer* une r√©ponse potentiellement *personnalis√©e*.

== Dynamisme ü§ò

Le principe des sites dynamiques est beaucoup plus *puissant* !

* on peut faire *pareil ou plus* que les sites statiques
* on peut impl√©menter des comportements *arbitraires*

== Dynamisme üò¨

Sauf que tout √ßa a un co√ªt en :

* complexit√© du syst√®me
* d√©pendances √† d'autres logiciels
* int√©grit√© des donn√©es
* √©tendue de la surface d'attaque
* performances
* ...

== Dynamisme üòá

Heureusement, on peut affronter ces probl√®mes gr√¢ce √† :

* la recherche scientifique
* des innovations industrielles
* des professionnels du logiciel
* des outils libres

== Content Management System

Un CMS est un site dynamique *pr√©-d√©velopp√©* pour g√©rer du contenu _sans avoir besoin de connaissances techniques_.

> Exemples : WordPress, Drupal, Joomla!, PrestaShop, ...

Quelques √©l√©ments de diff√©rentiation :

* hypoth√®ses sur le contenu
* interface d'√©dition du contenu
* extensibilit√©
* √©cosyst√®me (th√®mes, _add-ons_)

== CVE li√©es √† WordPress üò¨

[.stretch]
[link=https://nvd.nist.gov/vuln/search/statistics?form_type=Advanced&results_type=statistics&query=wordpress&search_type=all]
image::wordpress-cve.png[CVE li√©es √† WordPress]

== Prenons du recul

== Tout est compromis

En g√©n√©ral, quand on fait un site web, le probl√®me n'est pas de trouver une solution qui marche mais *d'√©valuer les risques/opportunit√©s* des solutions qui marchent pour choisir la meilleure.

== En r√©alit√©

C'est vraiment tr√®s difficile.
Il y a √©norm√©ment de param√®tres.

*‚Üí On choisit souvent √† l'instinct üòÖ*

== _Plot twist_ üò±

Limitations :

* les biais cognitifs
* les √©volution de l'√©cosyst√®me
* les connaissances imparfaites

*‚Üí N'arr√™tez jamais d'apprendre üôè*

== Sites dynamiques

Parfois, c'est cool de faire un site dynamique :

* les cas d'usage l'imposent
* acc√®s √† des abstractions
* ...

Parfois, c'est cool d'utiliser un CMS :

* pas besoin de r√©inventer la roue
* pas besoin de d√©veloppeur
* on a l'habitude
* ...

_Aujourd'hui on va parler des autres cas_ üòÑ

== Le projet du jour

Parfois, on veut un site :

* au contenu g√©rable par des *non-d√©veloppeurs*
* pour d√©livrer du contenu (*peu d'interactions*)
* au rendu *sp√©cifique et performant*
* *facile √† maintenir* sur le long terme

== Bienvenue dans ma conf√©rence !

> Avec les bonnes techniques, on peut satisfaire ces contraintes avec un site statique !

== Approche na√Øve

On √©dite et d√©ploie manuellement des fichiers HTML, CSS, JS, ...

_On utilise Git pour versionner tout √ßa_ üôè

* ‚ùå travail r√©p√©titif, pas d'abstractions/d'outils
* ‚ùå d√©ploiement sujet √† erreurs humaines

== G√©n√©rateur de sites statiques

On ajoute une √©tape de construction pour s√©parer :

* ce que le d√©veloppeur √©crit
* le produit fini (un site statique)

√áa permet d'utiliser des *abstractions* et des fonctionnalit√©s pr√©-d√©velopp√©es.

* langage de gabarit (_templating_)
* pagination
* blog (et flux RSS)
* ...

== Choisir un g√©n√©rateur

Il en existe *plein*. Quelques crit√®res :

* usage principal, fonctionnalit√©s
* format d'entr√©e
* extensibilit√© (‚áí langage utilis√©)
* √©cosyst√®me (modules, documentation, ...)
* facilit√© d'installation

> Exemples : Jekyll, Hugo, Gatsby, ...

== Avec un g√©n√©rateur

Une fois la techno choisie et ma√Ætris√©e, le d√©veloppement du site est plus rapide et sa maintenance bien plus facile !

_Comme on a d√©j√† pay√© le prix d'avoir une √©tape de construction, on peut l'exploiter encore plus (webpack, ...)._

* ‚úÖ travail r√©p√©titif, pas d'abstractions/d'outils
* ‚ùå d√©ploiement sujet √† erreurs humaines

== Int√©gration continue

> Un syst√®me lance des t√¢ches √† chaque fois qu'une nouvelle version du code est publi√©e.

* *g√©n√©rer* (produire des art√©facts)
* *v√©rifier* (√©viter le _"√ßa marche sur ma machine"_, lancer les tests automatis√©s)
* *d√©ployer*

TIP: Pour un site statique, on veut surtout g√©n√©rer le site et le d√©ployer.

== GitLab CI

C'est le syst√®me d'int√©gration continue li√© √† GitLab. Il est top üëå

[source.smallcode, yaml]
----
variables:
  DEBIAN_FRONTEND: noninteractive
  NODE_VERSION: 12

build:
  stage: build
  image: ruby:2.6-stretch
  script:
    - curl -sL https://deb.nodesource.com/setup_$NODE_VERSION.x | bash -
    - apt-get install -y nodejs
    - npm install
    - npm run build
    - bundle install
    - bundle exec jekyll build
  artifacts:
    paths:
      - _site/
  tags:
    - docker
----

== Avec un g√©n√©rateur + CI

* ‚úÖ travail r√©p√©titif, pas d'abstractions/d'outils
* ‚úÖ d√©ploiement sujet √† erreurs humaines
* ‚úÖ *facile √† maintenir* sur le long terme
* ‚ùå contenu g√©rable par des *non-d√©veloppeurs*

== Gestion du contenu

Dans la plupart des g√©n√©rateurs, le contenu est √† √©crire en *Markdown* et il faut savoir manipuler *Git*.

*‚Üí C'est un frein pour les non-d√©veloppeurs ü§¢*

== Gestion du contenu

Heureusement, il existe des *services* d'interface graphique d'√©dition :

. On configure le _sch√©ma_ des donn√©es
. On saisit les contenus via une interface graphique
. √Ä chaque g√©n√©ration du site, on r√©cup√®re les contenus via une API

> Exemples : Contentful, Prismic, Strapi, ...

== Contentful

[.stretch]
[link=https://www.contentful.com/]
image::contentful.png[]

== Contentful : sch√©ma

[.stretch]
image::schema.png[]

== Contentful : √©dition

[.stretch]
image::data.png[]

== contentful2md

[link=https://github.com/dsferruzza/contentful2md]
image::contentful2md.png[]

[source.smallcode, bash]
----
#!/usr/bin/env sh

export CONTENTFUL_SPACE="..."
export CONTENTFUL_ACCESS_TOKEN="..."
export CONTENTFUL_PREVIEW="true"
export CONTENTFUL_CONTENT_TYPE_ID="post"
export CONTENTFUL_LOCALE="fr-FR"
export OUTPUT_DIR="src/_articles"

npm run contentful2md
----

== Naddymess

[.stretch]
[link=https://www.naddymess.fr]
image::naddymess.png[]

== √âcrire un article Naddymess

. Avoir une id√©e [.line-through]#stupide# disruptive
. √âcrire l'article dans Contentful
. Cr√©er un _pipeline_ dans GitLab
. Attendre ~1 min

== Conclusion

Besoin :

* site web avec *peu d'interactions*
* 1+ d√©veloppeur √† disposition
* (contenu g√©rable par des *non-d√©veloppeurs*)

== Conclusion

Bilan (site statique) :

* *facilit√© de d√©veloppement* +
(versionnement, abstractions, outils)
* *facilit√© d'√©dition* +
(admin UI, _CI/CD_, multiples sources de donn√©es)
* *avantages des sites statiques* +
(s√©curit√©, performances, simplicit√©)

*‚Üí Je peux maintenir une dizaine de sites sans effort üòé*

== NetlifyCMS

. L'admin est *embarqu√©e* dans le site statique
. Les modifications sont *persist√©es* gr√¢ce √† l'API de GitHub/GitLab/Bitbucket
. Chaque modification entra√Æne un *re-d√©ploiement* du site

== NetlifyCMS

Bilan :

* potentiel : ü§©
* mise en place : üò£
* utilisation : üòêüôÇ

*‚Üí Tout n'est pas fluide mais √ßa √©volue, √† surveiller !*

== Questions ?

[.stretch]
image::question.gif[]

Twitter: https://twitter.com/d_sferruzza[@d_sferruzza]

Slides sur GitHub :

https://github.com/dsferruzza/conf-sites-statiques-modernes[dsferruzza/conf-sites-statiques-modernes]
